<!DOCTYPE html>
<html>
<head>
<title>ForwardObserver</title>
<meta http-equiv="Content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=0" />
<meta name="apple-mobile-web-app-capable" content="yes">
<link rel="stylesheet" type="text/css" css="css/map.css" />
<link rel="stylesheet" type="text/css" href="css/tomtom.map.min.css" />
<script type="text/javascript" src="js/leaflet.js"></script>
<script type="text/javascript" src="js/tomtom.map.js"></script>

<script type="text/javascript">

function haversineDistance(lat1,lon1,lat2,lon2){
        var d = Math.acos(Math.sin(lat1)*Math.sin(lat2) +
                          Math.cos(lat1)*Math.cos(lat2) *
                          Math.cos(lon2-lon1)) * R;
        return d;
}

function calculateBearing(lat1,lat2,dlon){
        var y = Math.sin(dLon) * Math.cos(lat2);
        var x = Math.cos(lat1)*Math.sin(lat2) -
                Math.sin(lat1)*Math.cos(lat2)*Math.cos(dLon);
        var bearing = Math.atan2(y, x).toDeg();
        // bearing needs to be 0 to 359 degrees
        return bearing;
}


function geoError(){
	document.write("Shit. Geolocation fucked up.");
}

function updateLocation(){
	// move the you are here marker to new location
	marker.setLatLng([position.coords.latitude, position.coords.longitude]);
	document.getElementById("header").textContent += "Heading: " + position.coords.heading;
	document.getElementById("header").textContent += "Speed: " + position.coords.speed;
	document.getElementById("header").textContent += "Time: " + position.coords.timestamp;
}

function initialize(){
	// we find out about where we are first
        if (navigator.geolocation){
                navigator.geolocation.getCurrentPosition(function(position){
			lat = position.coords.latitude;
			lon = position.coords.longitude;
			heading = position.coords.heading;
			speed = position.coords.speed;
			timestamp = position.coords.timestamp
			tomtom.setImagePath("/images/map");
			map = new tomtom.Map({ 
				domNode: "map", 
				apiKey: "q3dh8pqnwmbdrvwctrgvm6nu",
				center: [lat, lon],
				zoom: 15,
				zoomControl: true,
				enableHighAccuracy: true,
				watch: true,
				maximumAge: 6000,
			});
			
			map.setDisplayTraffic(true);

			var options = {
				iconUrl: "http://www.airmanopus.net/BoilerMake/images/marker.png", 
				iconSize: [41, 50],
				iconAnchor: [11, 39]
			};
			var marker = new tomtom.Marker([lat,lon], options);
			map.addLayer(marker);

			// done drawing on the map for now
			// next we take our location and ask twitter what is going on around us
			
		});

	}
}




function weather(latitude,longitude)
{
	weatherURL = "http://api.worldweatheronline.com/free/v1/weather.ashx?q=" + latitude + "%2C" + longitude + "&format=json&num_of_days=1&includelocation=yes&show_comments=no&key=kc2u593rw3h5bp2pga7fs7ut";
	weather = XMLHttpRequest();
	weather.open('GET',weatherURL,false);
	weather.send();
	if (weather.statusText = "200 OK") {
		document.getElementById("weather").textContent = weather.responseText;
	}
}



</script>
<style>



html, body, #map {
	width: 75%;
	height: 75%;
	padding: 1px;
	margin: 1px;
}
</style>
<body onLoad="initialize()">
<div id="map"></div>



</body>
</html>
