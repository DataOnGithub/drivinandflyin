<!DOCTYPE html>
<html>
<head>
<title>ForwardObserver</title>
<meta http-equiv="Content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=0" />
<meta name="apple-mobile-web-app-capable" content="yes">
<link rel="stylesheet" type="text/css" css="css/map.css" />
<link rel="stylesheet" type="text/css" href="css/tomtom.map.min.css" />
<script type="text/javascript" src="js/leaflet.js"></script>
<script type="text/javascript" src="js/tomtom.map.js"></script>

<script type="text/javascript">

function haversineDistance(lat1,lon1,lat2,lon2){
        var d = Math.acos(Math.sin(lat1)*Math.sin(lat2) +
                          Math.cos(lat1)*Math.cos(lat2) *
                          Math.cos(lon2-lon1)) * R;
        return d;
}

function calculateBearing(lat1,lat2,dlon){
        var y = Math.sin(dLon) * Math.cos(lat2);
        var x = Math.cos(lat1)*Math.sin(lat2) -
                Math.sin(lat1)*Math.cos(lat2)*Math.cos(dLon);
        var bearing = Math.atan2(y, x).toDeg();
        // bearing needs to be 0 to 359 degrees
        return bearing;
}


function geoError(){
	document.write("Shit. Geolocation fucked up.");
}

function updateLocation(){
	// move the you are here marker to new location
	marker.setLatLng([position.coords.latitude, position.coords.longitude]);

	map.on('heading', function(e) {
		alert(e.latlng);
	});
}

function initialize(){
        if (navigator.geolocation){
                navigator.geolocation.getCurrentPosition(function(position){
			lat = position.coords.latitude;
			lon = position.coords.longitude;
			tomtom.setImagePath("/images/map");
			map = new tomtom.Map({ 
				domNode: "map", 
				apiKey: "q3dh8pqnwmbdrvwctrgvm6nu",
				center: [lat, lon],
				zoom: 13,
				zoomControl: true,
				enableHighAccuracy: true,
				watch: true,
				maximumAge: 6000,
				displayTraffic: true
			});
			var options = {
				iconUrl: "http://www.airmanopus.net/BoilerMake/images/marker.png", 
				iconSize: [51, 60],
				iconAnchor: [21, 49]
			};
			var marker = new tomtom.Marker([lat,lon], options);
			map.addLayer(marker);
		});
	}
}

</script>
<style>
html, body, #map {
	width: 100%;
	height: 100%;
	padding: 0;
	margin: 0;
}
</style>
<body onLoad="initialize()">
<div id="header"><pre>some kinda title here</pre></div>
<div id="map"></div>
<div id="heading"></div>
<div id="speed"></div>
<div id="timestamp"></div>
<div id="footer">some kinda footer here</div>
</body>
</html>
