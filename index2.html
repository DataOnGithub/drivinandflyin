<!DOCTYPE HTML>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<title>AugmentReality</title>
<script type="text/javascript">

function setCookie(c_name,value,exdays)
    {
      var exdate=new Date();
      exdate.setDate(exdate.getDate() + exdays);
      var c_value=escape(value) + 
        ((exdays==null) ? "" : ("; expires="+exdate.toUTCString()));
      document.cookie=c_name + "=" + c_value;
    }

function getCookie(c_name)
    {
     var i,x,y,ARRcookies=document.cookie.split(";");
     for (i=0;i<ARRcookies.length;i++)
     {
      x=ARRcookies[i].substr(0,ARRcookies[i].indexOf("="));
      y=ARRcookies[i].substr(ARRcookies[i].indexOf("=")+1);
      x=x.replace(/^\s+|\s+$/g,"");
      if (x==c_name)
      {
       return unescape(y);
      }
     }
    }


function initialize(){
	if (navigator.geolocation) {
	navigator.geolocation.getCurrentPosition(function(position) {


	// the last location we had for the device
	// these will be null if no cookies still present
	// save these
	var prevLat = getCookie("latitude");
	var prevLon = getCookie("longitude");
	var prevTime = getCookie("currenttime");         

	// get the current location for the device
	lat = position.coords.latitude;
	lon = position.coords.longitude;

	// and overwrite the old values with the lat and lon we just got
	// and repeat next position update
	setCookie("latitude",lat,1);
	setCookie("longitude",lon,1);
	var currentTime = (new Date).getTime();
	setCookie("currenttime",currentTime,1);

	// look at the difference between current location and the last one
	// the time always changes but we can use that to set a timeout value
	var latitudeDelta;
	var longitudeDelta;	
	var timeDelta;

	// changes in latitude changes in attitude
	latitudeDelta = lat - prevLat;
	longitudeDelta = lon - prevLon;
	timeDelta = currentTime - prevTime;

	//  um no time has elasped we cannot have moved yet
	if ( timeDelta >= 0 ) {
		var latLonDelta = latitudeDelta + longitudeDelta;	
		//  both physical deltas are zero we have not moved
		if ( latLonDelta != 0 )  {
			// passed those tests so yay we moved a distance
			// that we will express in nautical miles
			// rather than trying to account exactly for roads
			var physicalLatDelta = Math.cos(latitudeDelta) * 60;
			var physicalLonDelta = Math.cos(longitudeDelta) * 60;

			// how fast the device is moving impacts the messages we will send 
			var NauticalLatSpeed = latitudeDelta / timeDelta;
			var NauticalLonSpeed = longitudeDelta / timeDelta;

			// comparing the current lat and lon to the previous coords
			// gives us a compass heading	
			var NorthSouth;
			var EastWest;
				
			if ( physicalLatitude = lat ) {
				// net movement was neither north nor south
				NorthSouth = "";
			}
			if ( physicalLatitude > lat ) {
				// net movement was to the north
				NorthSouth = "North";
			} else {
				// otherwise movement had to be southward
				NorthSouth = "South";
			}
			if ( physicalLongitude = lon ) {
				// net movement was neither east nor west
				EastWest = "";
			}
			if ( physicalLongitude > lon ) {
				// net movement was to the west
				EastWest = "West";
			} else { 
				// otherwise net movement had to be eastward
				EastWest = "East";
			}

			var heading = NorthSouth + " " + EastWest;
		} // latlondelta
	} // time delta
	)}; // current position
	
} // initaliz

</script>

</head>


<body onload="initialize()">

<div id="position"></div>
<div id="distance"></div>
<div id="warnings"></div>


</body>
</html>

